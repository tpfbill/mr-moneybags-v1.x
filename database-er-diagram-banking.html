<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Mr-Moneybags v1.x – Banking Modules Schema</title>
    <style>
        :root {
            /* Banking module colors */
            --recon-color: #f1f8e9;
            --recon-border: #c5e1a5;
            --deposit-color: #e0f7fa;
            --deposit-border: #80deea;
            --check-color: #fffde7;
            --check-border: #fff59d;
            
            /* Core reference tables */
            --core-ref-color: #e8eaf6;
            --core-ref-border: #9fa8da;
            
            /* Other styling variables */
            --pk-color: #ffebee;
            --fk-color: #e1f5fe;
            --hover-color: #fffde7;
            --related-highlight: #fff9c4;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .timestamp {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .description {
            max-width: 800px;
            margin: 0 auto 30px;
            text-align: center;
        }

        .controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin: 0 3px;
            font-size: 14px;
        }

        button:hover {
            background-color: #2980b9;
        }

        .schema-container {
            position: relative;
            overflow: auto;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 800px;
        }

        .schema-content {
            position: relative;
            min-width: 2500px;
            min-height: 1500px;
            transform-origin: top left;
        }

        .table-group {
            position: absolute;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .group-title {
            position: absolute;
            top: -10px;
            left: 20px;
            background-color: white;
            padding: 0 10px;
            font-weight: bold;
            color: #555;
            border-radius: 3px;
        }

        /* Group positioning and styling */
        .recon-group {
            top: 50px;
            left: 50px;
            background-color: var(--recon-color);
            border: 2px solid var(--recon-border);
            width: 1500px;
            height: 450px;
        }

        .deposit-group {
            top: 550px;
            left: 50px;
            background-color: var(--deposit-color);
            border: 2px solid var(--deposit-border);
            width: 700px;
            height: 350px;
        }

        .check-group {
            top: 550px;
            left: 800px;
            background-color: var(--check-color);
            border: 2px solid var(--check-border);
            width: 750px;
            height: 350px;
        }

        .core-ref-group {
            top: 950px;
            left: 50px;
            background-color: var(--core-ref-color);
            border: 2px solid var(--core-ref-border);
            width: 1500px;
            height: 350px;
        }

        /* Database table styling */
        .db-table {
            position: absolute;
            background-color: white;
            border: 2px solid #333;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: box-shadow 0.3s, transform 0.3s;
        }

        .db-table:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 10;
            background-color: var(--hover-color);
        }

        .table-header {
            background-color: #333;
            color: white;
            padding: 8px 10px;
            font-weight: bold;
            text-align: center;
            position: relative;
        }

        .table-content {
            padding: 0;
        }

        .field-row {
            padding: 5px 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
        }

        .field-row:last-child {
            border-bottom: none;
        }

        .field-name {
            flex: 1;
            font-weight: 500;
        }

        .field-type {
            flex: 1;
            color: #666;
        }

        .field-key {
            flex: 0.3;
            text-align: center;
            font-weight: bold;
        }

        .pk {
            color: #d32f2f;
            background-color: var(--pk-color);
            border-radius: 3px;
            padding: 0 3px;
        }

        .fk {
            color: #1976d2;
            background-color: var(--fk-color);
            border-radius: 3px;
            padding: 0 3px;
        }

        /* Table positioning */
        /* Bank Reconciliation Tables */
        #bank-statements-table {
            top: 40px;
            left: 50px;
            width: 280px;
        }

        #bank-statement-transactions-table {
            top: 40px;
            left: 350px;
            width: 280px;
        }

        #bank-reconciliations-table {
            top: 40px;
            left: 650px;
            width: 280px;
        }

        #bank-reconciliation-items-table {
            top: 40px;
            left: 950px;
            width: 280px;
        }

        #bank-reconciliation-adjustments-table {
            top: 40px;
            left: 1250px;
            width: 280px;
        }

        /* Bank Deposits Tables */
        #bank-deposits-table {
            top: 40px;
            left: 50px;
            width: 280px;
        }

        #bank-deposit-items-table {
            top: 40px;
            left: 350px;
            width: 280px;
        }

        /* Check Printing Tables */
        #check-formats-table {
            top: 40px;
            left: 50px;
            width: 280px;
        }

        #printed-checks-table {
            top: 40px;
            left: 350px;
            width: 280px;
        }

        /* Core Reference Tables */
        #bank-accounts-table {
            top: 40px;
            left: 50px;
            width: 280px;
        }

        #funds-table {
            top: 40px;
            left: 350px;
            width: 280px;
        }

        #journal-entries-table {
            top: 40px;
            left: 650px;
            width: 280px;
        }

        /* Relationship lines */
        .relationship-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        .relationship-line {
            position: absolute;
            background-color: #333;
            transform-origin: 0 50%;
            height: 2px;
            z-index: 5;
        }

        .relationship-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            z-index: 5;
        }

        .relationship-label {
            position: absolute;
            background-color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 6;
        }

        /* Legend */
        .legend {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .legend h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .highlighted {
            box-shadow: 0 0 0 3px var(--related-highlight) !important;
            z-index: 20 !important;
        }

        .highlighted-line {
            background-color: #f57c00 !important;
            height: 3px !important;
            z-index: 15 !important;
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            z-index: 1000;
            pointer-events: none;
            display: none;
        }

        /* Footer */
        footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
        }

        /* Back to Core link */
        .back-to-core {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 15px;
            background-color: #4caf50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
        }

        .back-to-core:hover {
            background-color: #388e3c;
        }
    </style>
</head>
<body>
    <header>
        <h1>Mr-Moneybags v1.x – Banking Modules Schema</h1>
        <div class="timestamp">Last updated: <span id="timestamp"></span></div>
    </header>

    <div class="description">
        <p>This interactive diagram depicts the <strong>banking modules</strong> of <strong>Mr.&nbsp;MoneyBags&nbsp;v1.x</strong> fund accounting system,
        including Bank Reconciliation, Bank Deposits, and Check Printing functionality.</p>
        <a href="database-er-diagram-core.html" class="back-to-core">← Back to Core Schema</a>
    </div>

    <div class="controls">
        <button id="zoomIn">Zoom In</button>
        <button id="zoomOut">Zoom Out</button>
        <button id="resetZoom">Reset Zoom</button>
        <button id="downloadImage">Download Image</button>
        <button id="refreshPage">Refresh Page</button>
    </div>

    <div class="schema-container">
        <div class="schema-content" id="schemaContent">
            <!-- Bank Reconciliation Group -->
            <div class="table-group recon-group">
                <div class="group-title">Bank Reconciliation</div>
                
                <!-- BANK_STATEMENTS Table -->
                <div class="db-table" id="bank-statements-table" data-table="bank_statements">
                    <div class="table-header">BANK_STATEMENTS</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">bank_account_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">statement_date</div>
                            <div class="field-type">date</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">start_date</div>
                            <div class="field-type">date</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">end_date</div>
                            <div class="field-type">date</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">opening_balance</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">closing_balance</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">status</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                    </div>
                </div>

                <!-- BANK_STATEMENT_TRANSACTIONS Table -->
                <div class="db-table" id="bank-statement-transactions-table" data-table="bank_statement_transactions">
                    <div class="table-header">BANK_STATEMENT_TRANSACTIONS</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">bank_statement_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">transaction_date</div>
                            <div class="field-type">date</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">description</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">amount</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">reference_number</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">transaction_type</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">status</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                    </div>
                </div>

                <!-- BANK_RECONCILIATIONS Table -->
                <div class="db-table" id="bank-reconciliations-table" data-table="bank_reconciliations">
                    <div class="table-header">BANK_RECONCILIATIONS</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">bank_account_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">bank_statement_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">reconciliation_date</div>
                            <div class="field-type">date</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">statement_balance</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">book_balance</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">status</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                    </div>
                </div>

                <!-- BANK_RECONCILIATION_ITEMS Table -->
                <div class="db-table" id="bank-reconciliation-items-table" data-table="bank_reconciliation_items">
                    <div class="table-header">BANK_RECONCILIATION_ITEMS</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">reconciliation_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">statement_transaction_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">journal_entry_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">match_type</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">amount</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">notes</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                    </div>
                </div>

                <!-- BANK_RECONCILIATION_ADJUSTMENTS Table -->
                <div class="db-table" id="bank-reconciliation-adjustments-table" data-table="bank_reconciliation_adjustments">
                    <div class="table-header">BANK_RECONCILIATION_ADJUSTMENTS</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">reconciliation_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">adjustment_date</div>
                            <div class="field-type">date</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">adjustment_type</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">amount</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">description</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">journal_entry_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bank Deposits Group -->
            <div class="table-group deposit-group">
                <div class="group-title">Bank Deposits</div>
                
                <!-- BANK_DEPOSITS Table -->
                <div class="db-table" id="bank-deposits-table" data-table="bank_deposits">
                    <div class="table-header">BANK_DEPOSITS</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">bank_account_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">deposit_date</div>
                            <div class="field-type">date</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">deposit_type</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">reference_number</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">description</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">status</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">submitted_date</div>
                            <div class="field-type">timestamp</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">cleared_date</div>
                            <div class="field-type">timestamp</div>
                            <div class="field-key"></div>
                        </div>
                    </div>
                </div>

                <!-- BANK_DEPOSIT_ITEMS Table -->
                <div class="db-table" id="bank-deposit-items-table" data-table="bank_deposit_items">
                    <div class="table-header">BANK_DEPOSIT_ITEMS</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">deposit_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">item_type</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">amount</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">check_number</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">payer_name</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">memo</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">fund_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Check Printing Group -->
            <div class="table-group check-group">
                <div class="group-title">Check Printing</div>
                
                <!-- CHECK_FORMATS Table -->
                <div class="db-table" id="check-formats-table" data-table="check_formats">
                    <div class="table-header">CHECK_FORMATS</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">format_name</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">description</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">check_width</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">check_height</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">payee_x</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">payee_y</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">amount_x</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">amount_y</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">is_default</div>
                            <div class="field-type">boolean</div>
                            <div class="field-key"></div>
                        </div>
                    </div>
                </div>

                <!-- PRINTED_CHECKS Table -->
                <div class="db-table" id="printed-checks-table" data-table="printed_checks">
                    <div class="table-header">PRINTED_CHECKS</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">bank_account_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">check_format_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">check_number</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">payee_name</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">amount</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">check_date</div>
                            <div class="field-type">date</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">memo</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">status</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">journal_entry_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Core Reference Tables Group -->
            <div class="table-group core-ref-group">
                <div class="group-title">Core Reference Tables</div>
                
                <!-- BANK_ACCOUNTS Table (Reference) -->
                <div class="db-table" id="bank-accounts-table" data-table="bank_accounts">
                    <div class="table-header">BANK_ACCOUNTS (Reference)</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">bank_name</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">account_name</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">account_number</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">routing_number</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">type</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">balance</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                    </div>
                </div>

                <!-- FUNDS Table (Reference) -->
                <div class="db-table" id="funds-table" data-table="funds">
                    <div class="table-header">FUNDS (Reference)</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">entity_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">name</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">code</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">type</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">balance</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                    </div>
                </div>

                <!-- JOURNAL_ENTRIES Table (Reference) -->
                <div class="db-table" id="journal-entries-table" data-table="journal_entries">
                    <div class="table-header">JOURNAL_ENTRIES (Reference)</div>
                    <div class="table-content">
                        <div class="field-row">
                            <div class="field-name">id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="pk">PK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">entity_id</div>
                            <div class="field-type">uuid</div>
                            <div class="field-key"><span class="fk">FK</span></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">entry_date</div>
                            <div class="field-type">date</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">reference_number</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">description</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">total_amount</div>
                            <div class="field-type">decimal</div>
                            <div class="field-key"></div>
                        </div>
                        <div class="field-row">
                            <div class="field-name">status</div>
                            <div class="field-type">string</div>
                            <div class="field-key"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Relationship lines container -->
            <div class="relationship-container" id="relationshipContainer"></div>
        </div>
    </div>

    <!-- Tooltip element -->
    <div class="tooltip" id="tooltip"></div>

    <!-- Legend -->
    <div class="legend">
        <h3>Schema Legend</h3>
        <div class="legend-grid">
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--recon-color);"></div>
                <span>Bank Reconciliation</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--deposit-color);"></div>
                <span>Bank Deposits</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--check-color);"></div>
                <span>Check Printing</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--core-ref-color);"></div>
                <span>Core Reference Tables</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--pk-color);"></div>
                <span>Primary Key (PK)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--fk-color);"></div>
                <span>Foreign Key (FK)</span>
            </div>
        </div>
    </div>

    <footer>
        <p>Mr-Moneybags-v1.x Banking Modules Schema &copy; 2025</p>
    </footer>

    <script>
        // Set timestamp
        document.getElementById('timestamp').textContent = new Date().toLocaleString();

        // Define relationships for banking modules
        const relationships = [
            // Bank Reconciliation relationships
            { from: 'bank_accounts', fromField: 'id', to: 'bank_statements', toField: 'bank_account_id', label: 'has_statements' },
            { from: 'bank_statements', fromField: 'id', to: 'bank_statement_transactions', toField: 'bank_statement_id', label: 'contains' },
            { from: 'bank_statements', fromField: 'id', to: 'bank_reconciliations', toField: 'bank_statement_id', label: 'reconciled_in' },
            { from: 'bank_accounts', fromField: 'id', to: 'bank_reconciliations', toField: 'bank_account_id', label: 'reconciled_with' },
            { from: 'bank_reconciliations', fromField: 'id', to: 'bank_reconciliation_items', toField: 'reconciliation_id', label: 'includes' },
            { from: 'bank_statement_transactions', fromField: 'id', to: 'bank_reconciliation_items', toField: 'statement_transaction_id', label: 'matched_in' },
            { from: 'journal_entries', fromField: 'id', to: 'bank_reconciliation_items', toField: 'journal_entry_id', label: 'reconciled_with' },
            { from: 'bank_reconciliations', fromField: 'id', to: 'bank_reconciliation_adjustments', toField: 'reconciliation_id', label: 'adjusted_by' },
            { from: 'journal_entries', fromField: 'id', to: 'bank_reconciliation_adjustments', toField: 'journal_entry_id', label: 'adjusted_by' },
            
            // Bank Deposits relationships
            { from: 'bank_accounts', fromField: 'id', to: 'bank_deposits', toField: 'bank_account_id', label: 'receives_deposits' },
            { from: 'bank_deposits', fromField: 'id', to: 'bank_deposit_items', toField: 'deposit_id', label: 'contains' },
            { from: 'funds', fromField: 'id', to: 'bank_deposit_items', toField: 'fund_id', label: 'allocated_to' },
            
            // Check Printing relationships
            { from: 'check_formats', fromField: 'id', to: 'printed_checks', toField: 'check_format_id', label: 'formats' },
            { from: 'bank_accounts', fromField: 'id', to: 'printed_checks', toField: 'bank_account_id', label: 'prints_checks' },
            { from: 'journal_entries', fromField: 'id', to: 'printed_checks', toField: 'journal_entry_id', label: 'generates_check' }
        ];

        // Draw relationship lines
        function drawRelationships() {
            const container = document.getElementById('relationshipContainer');
            container.innerHTML = '';
            
            relationships.forEach((rel, index) => {
                const fromTable = document.getElementById(`${rel.from.replace(/_/g, '-')}-table`);
                const toTable = document.getElementById(`${rel.to.replace(/_/g, '-')}-table`);
                
                if (!fromTable || !toTable) return;
                
                // Find field positions
                const fromFieldRow = Array.from(fromTable.querySelectorAll('.field-row')).find(row => 
                    row.querySelector('.field-name').textContent === rel.fromField
                );
                
                const toFieldRow = Array.from(toTable.querySelectorAll('.field-row')).find(row => 
                    row.querySelector('.field-name').textContent === rel.toField
                );
                
                if (!fromFieldRow || !toFieldRow) return;
                
                // Get positions
                const fromRect = fromTable.getBoundingClientRect();
                const toRect = toTable.getBoundingClientRect();
                const containerRect = document.querySelector('.schema-content').getBoundingClientRect();
                
                const fromFieldRect = fromFieldRow.getBoundingClientRect();
                const toFieldRect = toFieldRow.getBoundingClientRect();
                
                // Calculate positions relative to container
                const fromX = fromRect.left - containerRect.left + fromRect.width;
                const fromY = fromFieldRect.top - containerRect.top + fromFieldRect.height / 2;
                
                const toX = toRect.left - containerRect.left;
                const toY = toFieldRect.top - containerRect.top + toFieldRect.height / 2;
                
                // Create line
                const line = document.createElement('div');
                line.className = 'relationship-line';
                line.dataset.from = rel.from;
                line.dataset.to = rel.to;
                line.dataset.fromField = rel.fromField;
                line.dataset.toField = rel.toField;
                
                // Calculate line length and angle
                const length = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
                const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;
                
                // Position and rotate line
                line.style.width = `${length}px`;
                line.style.left = `${fromX}px`;
                line.style.top = `${fromY}px`;
                line.style.transform = `rotate(${angle}deg)`;
                
                // Create arrow
                const arrow = document.createElement('div');
                arrow.className = 'relationship-arrow';
                arrow.style.left = `${toX - 5}px`;
                arrow.style.top = `${toY - 5}px`;
                arrow.style.borderWidth = '5px 0 5px 8px';
                arrow.style.borderColor = 'transparent transparent transparent #333';
                
                // Create label
                const label = document.createElement('div');
                label.className = 'relationship-label';
                label.textContent = rel.label;
                
                // Position label at midpoint
                const midX = (fromX + toX) / 2;
                const midY = (fromY + toY) / 2;
                label.style.left = `${midX - 10}px`;
                label.style.top = `${midY - 10}px`;
                
                // Add to container
                container.appendChild(line);
                container.appendChild(arrow);
                container.appendChild(label);
            });
        }

        // Highlight related tables
        function highlightRelatedTables(tableId) {
            // Reset all highlights
            document.querySelectorAll('.db-table').forEach(table => {
                table.classList.remove('highlighted');
            });
            
            document.querySelectorAll('.relationship-line, .relationship-arrow').forEach(el => {
                el.classList.remove('highlighted-line');
            });
            
            if (!tableId) return;
            
            // Get table name from ID
            const tableName = tableId.replace('-table', '').replace(/-/g, '_');
            
            // Highlight the selected table
            document.getElementById(tableId).classList.add('highlighted');
            
            // Find related tables
            relationships.forEach(rel => {
                if (rel.from === tableName) {
                    const relatedTableId = `${rel.to.replace(/_/g, '-')}-table`;
                    const relatedTable = document.getElementById(relatedTableId);
                    if (relatedTable) {
                        relatedTable.classList.add('highlighted');
                    }
                    
                    // Highlight lines
                    document.querySelectorAll(`.relationship-line[data-from="${rel.from}"][data-to="${rel.to}"][data-from-field="${rel.fromField}"][data-to-field="${rel.toField}"]`).forEach(line => {
                        line.classList.add('highlighted-line');
                    });
                } 
                else if (rel.to === tableName) {
                    const relatedTableId = `${rel.from.replace(/_/g, '-')}-table`;
                    const relatedTable = document.getElementById(relatedTableId);
                    if (relatedTable) {
                        relatedTable.classList.add('highlighted');
                    }
                    
                    // Highlight lines
                    document.querySelectorAll(`.relationship-line[data-from="${rel.from}"][data-to="${rel.to}"][data-from-field="${rel.fromField}"][data-to-field="${rel.toField}"]`).forEach(line => {
                        line.classList.add('highlighted-line');
                    });
                }
            });
        }

        // Add event listeners to tables
        document.querySelectorAll('.db-table').forEach(table => {
            table.addEventListener('mouseenter', () => {
                highlightRelatedTables(table.id);
            });
            
            table.addEventListener('mouseleave', () => {
                highlightRelatedTables(null);
            });
        });

        // Tooltip functionality
        const tooltip = document.getElementById('tooltip');
        
        document.querySelectorAll('.field-row').forEach(row => {
            row.addEventListener('mouseenter', (e) => {
                const fieldName = row.querySelector('.field-name').textContent;
                const fieldType = row.querySelector('.field-type').textContent;
                const keyType = row.querySelector('.field-key').textContent.trim();
                
                let tooltipText = `${fieldName} (${fieldType})`;
                
                if (keyType === 'PK') {
                    tooltipText += ' - Primary Key';
                } else if (keyType === 'FK') {
                    tooltipText += ' - Foreign Key';
                    
                    // Find relationship info
                    const tableId = row.closest('.db-table').id;
                    const tableName = tableId.replace('-table', '').replace(/-/g, '_');
                    
                    relationships.forEach(rel => {
                        if (rel.to === tableName && rel.toField === fieldName) {
                            tooltipText += ` → References ${rel.from}.${rel.fromField}`;
                        }
                    });
                }
                
                tooltip.textContent = tooltipText;
                tooltip.style.left = `${e.pageX + 10}px`;
                tooltip.style.top = `${e.pageY + 10}px`;
                tooltip.style.display = 'block';
            });
            
            row.addEventListener('mousemove', (e) => {
                tooltip.style.left = `${e.pageX + 10}px`;
                tooltip.style.top = `${e.pageY + 10}px`;
            });
            
            row.addEventListener('mouseleave', () => {
                tooltip.style.display = 'none';
            });
        });

        // Zoom functionality
        let currentZoom = 1;
        const schemaContent = document.getElementById('schemaContent');
        
        document.getElementById('zoomIn').addEventListener('click', () => {
            currentZoom += 0.1;
            applyZoom();
        });
        
        document.getElementById('zoomOut').addEventListener('click', () => {
            if (currentZoom > 0.5) {
                currentZoom -= 0.1;
                applyZoom();
            }
        });
        
        document.getElementById('resetZoom').addEventListener('click', () => {
            currentZoom = 1;
            applyZoom();
        });
        
        function applyZoom() {
            schemaContent.style.transform = `scale(${currentZoom})`;
            // Redraw relationships after zoom
            setTimeout(drawRelationships, 100);
        }

        // Download image functionality
        document.getElementById('downloadImage').addEventListener('click', () => {
            alert('To download as image, please use your browser\'s screenshot functionality or a screen capture tool.');
        });

        // Refresh page
        document.getElementById('refreshPage').addEventListener('click', () => {
            window.location.reload();
        });

        // Draw relationships on load
        window.addEventListener('load', () => {
            setTimeout(drawRelationships, 500);
        });

        // Redraw relationships on window resize
        window.addEventListener('resize', () => {
            setTimeout(drawRelationships, 100);
        });
    </script>
</body>
</html>
