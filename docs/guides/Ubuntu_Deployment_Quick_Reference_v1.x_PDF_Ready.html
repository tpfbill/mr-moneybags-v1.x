<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ubuntu Deployment â€“ Quick Reference (v1.x)</title>
    <style>
        /* Print-friendly styles */
        @page {
            size: letter;
            margin: 0.75in 0.5in;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.4;
            color: #333;
            max-width: 8.5in;
            margin: 0 auto;
            padding: 0.25in 0;
            font-size: 10pt;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
            page-break-after: avoid;
            margin-top: 1em;
            margin-bottom: 0.3em;
        }
        h1 {
            font-size: 20pt;
            text-align: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
            margin-bottom: 15px;
        }
        h2 {
            font-size: 14pt;
            border-bottom: 1px solid #eee;
            padding-bottom: 3px;
        }
        h3 {
            font-size: 12pt;
        }
        h4 {
            font-size: 11pt;
        }
        p, li, td, th {
            font-size: 10pt;
            page-break-inside: avoid;
        }
        code, pre {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        code {
            padding: 1px 3px;
            font-size: 90%;
        }
        pre {
            padding: 8px;
            overflow-x: auto;
            font-size: 9pt;
            page-break-inside: avoid;
            white-space: pre-wrap;
            margin: 8px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            page-break-inside: avoid;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 5px 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        hr {
            border: none;
            border-top: 1px solid #eee;
            margin: 15px 0;
        }
        blockquote {
            border-left: 4px solid #ddd;
            padding-left: 10px;
            color: #555;
            margin: 12px 0;
            font-style: italic;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        .reference-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }
        .two-column {
            column-count: 2;
            column-gap: 20px;
        }
        .compact-table td, .compact-table th {
            padding: 3px 6px;
            font-size: 9pt;
        }
        /* Print-specific adjustments */
        @media print {
            body {
                padding: 0;
            }
            pre, code {
                background-color: #f8f8f8 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            th {
                background-color: #f2f2f2 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            a {
                color: #000;
                text-decoration: underline;
            }
            a::after {
                content: " (" attr(href) ")";
                font-size: 90%;
                color: #555;
            }
            .reference-card {
                background-color: #f9f9f9 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body>
    <h1>Ubuntu Deployment â€“ Quick Reference (v1.x)</h1>
    <p style="text-align: center;"><strong>Server user:</strong> <code>fundapp</code>  <strong>App dir:</strong> <code>/opt/mr-moneybags-v1.x</code></p>

    <hr>

    <div class="reference-card">
        <h2>1. Essential Deployment Commands</h2>
        <table class="compact-table">
            <thead>
                <tr>
                    <th>Scenario</th>
                    <th>Command</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Standard update (main)</strong></td>
                    <td><code>cd /opt/mr-moneybags-v1.x && git pull --ff-only && npm ci && ./deploy-ubuntu.sh</code></td>
                </tr>
                <tr>
                    <td><strong>Deploy release tag</strong></td>
                    <td><code>./deploy-ubuntu.sh --tag v1.0.1</code></td>
                </tr>
                <tr>
                    <td><strong>Deploy feature branch</strong></td>
                    <td><code>./deploy-ubuntu.sh --branch feature/x</code></td>
                </tr>
                <tr>
                    <td><strong>Skip dependency install</strong></td>
                    <td><code>./deploy-ubuntu.sh --skip-dependencies</code></td>
                </tr>
                <tr>
                    <td><strong>Skip DB schema refresh</strong></td>
                    <td><code>./deploy-ubuntu.sh --skip-schema</code></td>
                </tr>
                <tr>
                    <td><strong>Force deploy (ignore failed checks)</strong></td>
                    <td><code>./deploy-ubuntu.sh --force</code></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="reference-card">
        <h2>2. Common Troubleshooting</h2>
        <div class="two-column">
            <pre><code># Backend / frontend logs
pm2 logs fund-api       # API
pm2 logs fund-ui        # UI

# PostgreSQL status & logs
sudo systemctl status postgresql
journalctl -u postgresql -n 50

# Port usage
sudo lsof -i :3000
sudo lsof -i :8080</code></pre>
        </div>
    </div>

    <div class="reference-card">
        <h2>3. Health Checks</h2>
        <div class="two-column">
            <pre><code># API
curl -s http://localhost:3000/api/health | jq

# Front-end
curl -I http://localhost:8080 | head -n1    # 200 OK

# Database
psql -U npfadmin -d fund_accounting_db -c "SELECT 1;"</code></pre>
        </div>
    </div>

    <div class="reference-card">
        <h2>4. Rollback</h2>
        <table class="compact-table">
            <thead>
                <tr>
                    <th>Action</th>
                    <th>Command</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Previous version</td>
                    <td><code>./deploy-ubuntu.sh --rollback</code></td>
                </tr>
                <tr>
                    <td>Specific tag</td>
                    <td><code>./deploy-ubuntu.sh --rollback v8.8.4</code></td>
                </tr>
                <tr>
                    <td>Refresh schema</td>
                    <td><code>psql -U npfadmin -d fund_accounting_db -f database/db-init.sql</code></td>
                </tr>
                <tr>
                    <td>DB restore dump</td>
                    <td><code>pg_restore -U npfadmin -d fund_accounting_db /backups/FILE.dump</code></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="reference-card">
        <h2>5. Emergency Procedures</h2>
        <pre><code># Stop all app services
pm2 stop fund-api fund-ui

# Stop PostgreSQL (last resort)
sudo systemctl stop postgresql

# Disable incoming traffic (ufw)
sudo ufw deny 80/tcp
sudo ufw deny 443/tcp</code></pre>
        <p><em>After stabilising, run rollback (above) then <code>pm2 restart fund-api fund-ui</code> and re-enable UFW.</em></p>
    </div>

    <div class="reference-card">
        <h2>6. Key File Locations</h2>
        <table class="compact-table">
            <thead>
                <tr>
                    <th>Path</th>
                    <th>Purpose</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>/opt/mr-moneybags-v1.x/.env</code></td>
                    <td>Runtime environment variables</td>
                </tr>
                <tr>
                    <td><code>/var/log/mr-moneybags-v1.x/</code></td>
                    <td>Deployment & script logs</td>
                </tr>
                <tr>
                    <td><code>~/.pm2/logs/</code></td>
                    <td>PM2 service logs</td>
                </tr>
                <tr>
                    <td><code>/opt/backups/mr-moneybags-v1.x/</code></td>
                    <td>Code & DB backups (auto by script)</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="reference-card">
        <h2>7. Service Management (PM2 & Systemd)</h2>
        <div class="two-column">
            <pre><code># PM2
pm2 ls                          # list services
pm2 restart fund-api fund-ui    # graceful reload
pm2 save && pm2 startup         # persist across reboot

# PostgreSQL
sudo systemctl restart postgresql
sudo systemctl enable postgresql</code></pre>
        </div>
    </div>

    <hr>

    <p style="text-align: center;"><strong>Tip:</strong> keep this card handy during maintenance windows for rapid reference.<br>
    For full details see <code>Ubuntu Deployment Guide â€“ v1.x</code>. ðŸš€</p>

    <div style="text-align: center; margin-top: 30px; font-size: 9pt; color: #777;">
        <p>Mr. MoneyBags v1.x Documentation<br>
        Â© 2025 The Principle Foundation<br>
        Last updated: August 6, 2025</p>
    </div>
</body>
</html>
